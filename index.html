<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>0x Battle Hub</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="theme-color" content="#141d2b">
<style>
/* ========== CORE RESET ========== */
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;margin:0;padding:0;}
html,body{height:100%;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;}
body{background:radial-gradient(circle at 60% 40%,#141d2b 55%,#4a1670);color:#eef4ff;display:flex;justify-content:center;}
/* ========== LAYOUT WRAPPER ========== */
.app{width:100%;max-width:560px;min-height:100vh;display:flex;flex-direction:column;padding:14px 14px 28px;}
/* HEADER */
.header{display:flex;align-items:center;justify-content:space-between;background:rgba(255,255,255,.07);backdrop-filter:blur(8px);padding:10px 14px;border-radius:16px;box-shadow:0 0 14px #7c3aed55;}
.logo{font-weight:700;font-size:1.1rem;letter-spacing:.5px;background:linear-gradient(90deg,#ff5c7c,#ffbe0b);-webkit-background-clip:text;color:transparent;}
.top-btns button{background:rgba(255,255,255,.12);border:none;color:#fff;font-size:1.05rem;width:40px;height:40px;border-radius:14px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-weight:600;transition:.18s;box-shadow:0 0 8px #06b6d455;}
.top-btns button:active{transform:scale(.92);}
.top-btns button:hover{background:linear-gradient(90deg,#7c3aed,#06b6d4);}
.muted{opacity:.55;}
/* FOOTER */
.footer{text-align:center;margin-top:auto;font-size:.65rem;opacity:.55;letter-spacing:1px;padding-top:32px;}
/* SCREEN SYSTEM */
.screen{display:none;flex-direction:column;animation:fade .35s;}
.screen.active{display:flex;}
@keyframes fade{0%{opacity:0;transform:translateY(10px);}100%{opacity:1;transform:translateY(0);}}
h2.title{font-size:1.4rem;margin:6px 0 14px;font-weight:700;letter-spacing:.5px;text-align:center;background:linear-gradient(90deg,#7c3aed,#56e6ff);-webkit-background-clip:text;color:transparent;}
/* GAME SELECT GRID */
.game-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:14px;width:100%;margin-bottom:14px;}
.game-card{background:rgba(255,255,255,.1);padding:18px 14px;border-radius:18px;display:flex;flex-direction:column;align-items:center;gap:4px;cursor:pointer;box-shadow:0 0 12px #7c3aed44;transition:.2s;position:relative;}
.game-card .ic{font-size:2.1rem;}
.game-card .nm{font-weight:700;font-size:.95rem;letter-spacing:.5px;}
.game-card .ds{font-size:.7rem;opacity:.75;text-align:center;line-height:1.25;}
.game-card.selected{outline:2px solid #56e6ff;background:linear-gradient(145deg,#2a1f40,#40265e);}
.game-card:active{transform:scale(.94);}
.game-card:hover{background:linear-gradient(145deg,#332852,#543079);}
.info-small{text-align:center;font-size:.7rem;opacity:.6;margin-top:2px;}
/* MODE BUTTONS */
.mode-row{display:flex;gap:12px;flex-wrap:wrap;justify-content:center;margin-bottom:8px;}
.mode-btn{flex:1;min-width:140px;background:linear-gradient(90deg,#7c3aed,#06b6d4);color:#fff;border:none;padding:14px 10px;border-radius:16px;font-weight:700;letter-spacing:.5px;font-size:.9rem;cursor:pointer;box-shadow:0 0 14px #06b6d455;transition:.2s;}
.mode-btn.selected{background:linear-gradient(90deg,#ff5c7c,#ffbe0b);box-shadow:0 0 18px #ff5c7c66;}
.mode-btn:active{transform:scale(.92);}
.nav-row{display:flex;gap:10px;margin-top:10px;}
/* INPUTS */
.name-zone{display:flex;flex-direction:column;align-items:center;gap:10px;}
.name-zone input{width:100%;max-width:230px;background:rgba(255,255,255,.12);border:none;padding:12px 14px;border-radius:14px;color:#fff;font-weight:600;font-size:.9rem;text-align:center;box-shadow:0 0 10px #7c3aed33;outline:none;}
.name-zone input:focus{background:rgba(255,255,255,.18);}
.summary-box{background:rgba(255,255,255,.12);padding:16px 18px;border-radius:18px;font-size:.85rem;line-height:1.5;box-shadow:0 0 12px #06b6d455;}
/* BUTTON BASE */
.btn{background:linear-gradient(90deg,#ff5c7c,#ffbe0b);border:none;color:#222;font-weight:700;letter-spacing:.5px;padding:14px 22px;border-radius:16px;font-size:.9rem;cursor:pointer;box-shadow:0 0 16px #ff5c7c55;flex:1;transition:.2s;display:flex;align-items:center;justify-content:center;gap:6px;}
.btn:disabled{opacity:.4;cursor:not-allowed;box-shadow:none;}
.btn:active{transform:scale(.93);}
.btn.sec{background:linear-gradient(90deg,#7c3aed,#06b6d4);color:#fff;}
.btn.full{width:100%;}
/* GAME CONTAINER */
#gameStage{margin-top:8px;flex:1;display:none;flex-direction:column;}
#gameStage.active{display:flex;}
/* TIC TAC TOE */
.tt-wrap{display:flex;flex-direction:column;align-items:center;gap:10px;margin-top:4px;}
.tt-head{font-size:1.2rem;font-weight:700;letter-spacing:.5px;background:linear-gradient(90deg,#ff5c7c,#56e6ff);-webkit-background-clip:text;color:transparent;text-align:center;}
.tt-players{font-size:.75rem;opacity:.7;margin-top:-4px;}
.tt-grid{display:grid;grid-template-columns:repeat(3,90px);gap:10px;margin-top:10px;}
@media (max-width:480px){.tt-grid{grid-template-columns:repeat(3,78px);gap:8px;}}
.tt-cell{width:100%;aspect-ratio:1;background:rgba(255,255,255,.12);border-radius:18px;display:flex;align-items:center;justify-content:center;font-size:2.3rem;font-weight:800;cursor:pointer;position:relative;transition:.18s;box-shadow:0 0 10px #7c3aed44;}
.tt-cell:active{transform:scale(.9);}
.tt-cell.win{background:#ffbe0b;color:#222;box-shadow:0 0 18px #ffbe0b99;transform:scale(1.08);}
.tt-status{min-height:40px;font-size:.95rem;font-weight:600;text-align:center;padding:4px 8px;}
.badge{display:inline-block;padding:4px 10px;border-radius:12px;background:linear-gradient(90deg,#7c3aed,#06b6d4);font-size:.65rem;letter-spacing:1px;margin-top:2px;}
.confetti{pointer-events:none;position:fixed;inset:0;z-index:999;overflow:hidden;}
/* TOAST */
.toast{position:fixed;left:50%;bottom:22px;transform:translateX(-50%) translateY(50px);background:rgba(0,0,0,.7);color:#fff;padding:10px 16px;border-radius:14px;font-size:.75rem;font-weight:600;letter-spacing:.5px;opacity:0;transition:.35s;z-index:500;}
.toast.show{transform:translateX(-50%) translateY(0);opacity:1;}
/* UTILS */
.hidden{display:none !important;}
.center{text-align:center;}
.small{font-size:.7rem;opacity:.7;}
hr{border:none;height:1px;background:linear-gradient(90deg,transparent,#ffffff33,transparent);margin:14px 0;}
</style>
</head>
<body>
<div class="app">
  <!-- HEADER -->
  <div class="header">
    <div class="logo">üéÆ 0x Battle Hub</div>
    <div class="top-btns">
      <button id="btnMusic" title="Music On/Off">üîä</button>
    </div>
  </div>

  <!-- SCREENS WRAPPER -->
  <div id="flow">
    <!-- STEP 0: GAME SELECT -->
    <div class="screen active" data-step="0" id="screenGame">
      <h2 class="title">Choose Your Game</h2>
      <div class="game-grid" id="gameGrid">
        <div class="game-card" data-game="tictac">
          <div class="ic">‚ùå‚≠ï</div>
            <div class="nm">Tic Tac Toe</div>
          <div class="ds">Mind duel + AI</div>
        </div>
        <div class="game-card disabled" style="opacity:.35;pointer-events:none;">
          <div class="ic">üêç</div><div class="nm">Snake & Ladder</div>
          <div class="ds">Coming next step</div>
        </div>
        <div class="game-card disabled" style="opacity:.35;pointer-events:none;">
          <div class="ic">üü¶</div><div class="nm">Dot Box</div>
          <div class="ds">Coming next step</div>
        </div>
      </div>
      <button class="btn full" id="toMode" disabled>Next ‚û°Ô∏è</button>
      <div class="info-small">Step 1: Only TicTacToe active</div>
    </div>

    <!-- STEP 1: MODE -->
    <div class="screen" data-step="1" id="screenMode">
      <h2 class="title">Select Mode</h2>
      <div class="mode-row">
        <button class="mode-btn" data-mode="ai">Play vs AI ü§ñ</button>
        <button class="mode-btn" data-mode="friend">Play with Friend üë•</button>
      </div>
      <div class="nav-row">
        <button class="btn sec" id="backToGame">‚¨Ö Back</button>
        <button class="btn" id="toNames" disabled>Next ‚û°Ô∏è</button>
      </div>
      <div class="small center" style="margin-top:6px;">AI = Strong (Perfect)</div>
    </div>

    <!-- STEP 2: NAMES -->
    <div class="screen" data-step="2" id="screenNames">
      <h2 class="title">Enter Player Name(s)</h2>
      <div class="name-zone" id="nameZone"></div>
      <div class="nav-row">
        <button class="btn sec" id="backToMode">‚¨Ö Back</button>
        <button class="btn" id="toSummary" disabled>Next ‚û°Ô∏è</button>
      </div>
    </div>

    <!-- STEP 3: SUMMARY -->
    <div class="screen" data-step="3" id="screenSummary">
      <h2 class="title">Summary</h2>
      <div class="summary-box" id="summaryBox"></div>
      <div class="nav-row" style="margin-top:14px;">
        <button class="btn sec" id="backToNames">‚¨Ö Back</button>
        <button class="btn" id="startGame">Start Game üöÄ</button>
      </div>
    </div>
  </div>

  <!-- GAME STAGE -->
  <div id="gameStage">
    <!-- Game mounts here -->
    <div id="gameContainer"></div>
    <div class="nav-row" style="margin-top:18px;">
      <button class="btn sec" id="backHome">‚¨Ö Home</button>
      <button class="btn" id="restartGame">üîÑ Restart</button>
    </div>
  </div>

  <div class="footer">¬© 2025 0x Battle Hub ‚Ä¢ Step 1</div>
</div>

<!-- Toast -->
<div id="toast" class="toast"></div>
<!-- Confetti -->
<div id="confetti" class="confetti"></div>

<script>
/* ===============================
   STATE
=============================== */
let selectedGame = '';
let selectedMode = '';
let player1 = '';
let player2 = '';
let currentStep = 0;

/* ===============================
   HELPERS
=============================== */
const qs = sel => document.querySelector(sel);
const qsa = sel => [...document.querySelectorAll(sel)];
function showStep(n){
  currentStep = n;
  qsa('.screen').forEach(sc=> sc.classList.toggle('active', +sc.dataset.step===n));
  qs('#gameStage').classList.remove('active');
  window.scrollTo({top:0,behavior:'smooth'});
}
function toast(msg, ms=1700){
  const t = qs('#toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(()=> t.classList.remove('show'), ms);
}
function playClick(){ Sound.play('click'); }

/* ===============================
   SOUND MANAGER (INLINE SIMPLE)
=============================== */
const Sound = {
  muted: false,
  pool: {},
  init(){
    this.create('click', 180, 0.15);
    this.create('win', 420, 0.25);
    this.create('move', 300, 0.18);
  },
  create(name, freq, gain=0.2){
    this.pool[name] = {freq,gain};
  },
  play(name){
    if(this.muted) return;
    if(!this.pool[name]) return;
    const ctx = this._ctx || (this._ctx = new (window.AudioContext||window.webkitAudioContext)());
    const o = ctx.createOscillator();
    const g = ctx.createGain();
    o.type = name==='win'?'triangle':'sine';
    o.frequency.value = this.pool[name].freq;
    g.gain.value = this.pool[name].gain;
    o.connect(g); g.connect(ctx.destination);
    o.start();
    o.stop(ctx.currentTime + 0.18);
  }
};
Sound.init();

/* MUSIC (SIMPLE LOOP TONE) ‚Äì placeholder */
let musicCtx, musicOsc, musicGain;
function startMusic(){
  if(Sound.muted) return;
  if(musicOsc) return;
  musicCtx = musicCtx || new (window.AudioContext||window.webkitAudioContext)();
  musicOsc = musicCtx.createOscillator();
  musicGain = musicCtx.createGain();
  musicOsc.type='sawtooth';
  musicOsc.frequency.value=110;
  musicGain.gain.value=0.05;
  musicOsc.connect(musicGain); musicGain.connect(musicCtx.destination);
  musicOsc.start();
}
function stopMusic(){
  if(musicOsc){
    musicOsc.stop();
    musicOsc.disconnect();
    musicOsc=null;
  }
}

/* ===============================
   FLOW ELEMENTS
=============================== */
const gameGrid = qs('#gameGrid');
const toModeBtn = qs('#toMode');
const toNamesBtn = qs('#toNames');
const toSummaryBtn = qs('#toSummary');
const startBtn = qs('#startGame');
const summaryBox = qs('#summaryBox');

gameGrid.addEventListener('click', e=>{
  const card = e.target.closest('.game-card');
  if(!card || card.classList.contains('disabled')) return;
  qsa('.game-card').forEach(c=>c.classList.remove('selected'));
  card.classList.add('selected');
  selectedGame = card.dataset.game;
  toModeBtn.disabled = !selectedGame;
  playClick();
});

toModeBtn.addEventListener('click', ()=>{
  if(!selectedGame) return;
  playClick();
  showStep(1);
});
qs('#backToGame').onclick = ()=>{ playClick(); showStep(0); };

qsa('.mode-btn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    qsa('.mode-btn').forEach(b=>b.classList.remove('selected'));
    btn.classList.add('selected');
    selectedMode = btn.dataset.mode;
    toNamesBtn.disabled=false;
    playClick();
  });
});
toNamesBtn.onclick = ()=> { if(!selectedMode)return; playClick(); buildNameInputs(); showStep(2); };
qs('#backToMode').onclick = ()=> { playClick(); showStep(1); };

function buildNameInputs(){
  const zone = qs('#nameZone');
  zone.innerHTML='';
  if(selectedMode==='ai'){
    zone.innerHTML = `
      <input id="p1" placeholder="Your Name">
      <div class="small">AI automatically opponent hai (perfect)</div>
    `;
  } else {
    zone.innerHTML = `
      <input id="p1" placeholder="Player 1 Name">
      <input id="p2" placeholder="Player 2 Name">
    `;
  }
  const inputs = zone.querySelectorAll('input');
  inputs.forEach(inp=>inp.addEventListener('input',()=>{
    if(selectedMode==='ai'){
      player1 = zone.querySelector('#p1').value.trim();
      player2 = 'AI';
      toSummaryBtn.disabled = !player1;
    }else{
      player1 = zone.querySelector('#p1').value.trim();
      player2 = zone.querySelector('#p2').value.trim();
      toSummaryBtn.disabled = !(player1 && player2);
    }
  }));
  toSummaryBtn.disabled = true;
}

toSummaryBtn.onclick = ()=>{
  playClick();
  summaryBox.innerHTML = `
    <b>Game:</b> ${gameName(selectedGame)}<br>
    <b>Mode:</b> ${selectedMode==='ai'?'AI vs You':'Friend vs Friend'}<br>
    <b>Players:</b> ${player1} vs ${player2}
  `;
  showStep(3);
};
qs('#backToNames').onclick = ()=>{ playClick(); showStep(2); };

startBtn.onclick = ()=>{
  playClick();
  startGame();
};

function gameName(id){
  return {tictac:'Tic Tac Toe',snake:'Snake & Ladder',dotbox:'Dot Box'}[id]||id;
}

/* ===============================
   START GAME
=============================== */
function startGame(){
  qs('#flow').querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  qs('#gameStage').classList.add('active');
  // Only tictac for step 1
  if(selectedGame==='tictac'){
    renderTicTacToe();
  }else{
    qs('#gameContainer').innerHTML = '<div style="padding:30px;text-align:center;">Coming Next Step</div>';
  }
  startMusic();
}

qs('#backHome').onclick = ()=>{
  playClick();
  resetFlow();
};
qs('#restartGame').onclick = ()=>{
  playClick();
  if(selectedGame==='tictac') renderTicTacToe();
};

function resetFlow(){
  stopMusic();
  Sound.muted && startMusic(); // ignore if muted
  selectedGame='';selectedMode='';player1='';player2='';
  toModeBtn.disabled=true;
  toNamesBtn.disabled=true;
  toSummaryBtn.disabled=true;
  qsa('.game-card').forEach(c=>c.classList.remove('selected'));
  qsa('.mode-btn').forEach(c=>c.classList.remove('selected'));
  showStep(0);
  qs('#gameStage').classList.remove('active');
  qs('#gameContainer').innerHTML='';
}

/* ===============================
   MUSIC TOGGLE
=============================== */
qs('#btnMusic').onclick = ()=>{
  Sound.muted = !Sound.muted;
  const ic = qs('#btnMusic');
  if(Sound.muted){
    stopMusic();
    ic.classList.add('muted');
    ic.textContent='üîá';
    toast('Music Off');
  } else {
    ic.classList.remove('muted');
    ic.textContent='üîä';
    startMusic();
    toast('Music On');
  }
  playClick();
};

/* ===============================
   TIC TAC TOE (STRONG AI)
=============================== */
function renderTicTacToe(){
  const root = qs('#gameContainer');
  root.innerHTML = `
    <div class="tt-wrap">
      <div class="tt-head">Tic Tac Toe</div>
      <div class="tt-players">${player1} <span style="opacity:.6;">vs</span> ${player2}</div>
      <div class="tt-grid" id="ttGrid"></div>
      <div class="tt-status" id="ttStatus"></div>
    </div>
  `;
  const gridEl = qs('#ttGrid');
  const statusEl = qs('#ttStatus');
  let board = Array(9).fill(null);
  let human = 'X';
  let ai = 'O';
  let turn = 'X';
  let finished = false;

  // If friend mode -> no AI
  const vsAI = (selectedMode==='ai');

  function draw(){
    gridEl.innerHTML='';
    board.forEach((val,i)=>{
      const d = document.createElement('div');
      d.className='tt-cell';
      d.textContent = val ? (val==='X'?'‚ùå':'‚≠ï') : '';
      d.addEventListener('click',()=>handleCell(i));
      gridEl.appendChild(d);
    });
    updateStatus();
  }

  function updateStatus(){
    if(finished) return;
    statusEl.innerHTML = `<span class="badge">TURN</span><br>${turn===human?player1: (vsAI && turn===ai ? 'AI ü§ñ' : player2)}`;
  }

  function handleCell(i){
    if(finished || board[i]) return;
    if(vsAI && turn!==human) return;
    board[i]=turn;
    Sound.play('move');
    checkGame();
    if(!finished){
      turn = (turn==='X')?'O':'X';
      draw();
      if(vsAI && turn===ai){
        setTimeout(aiMove, 260);
      }
    }else{
      draw();
    }
  }

  function emptyIndices(b){
    return b.map((v,i)=>v?null:i).filter(v=>v!==null);
  }

  function checkWin(b){
    const lines=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
    for(const [a,c,d] of lines){
      if(b[a] && b[a]===b[c] && b[a]===b[d]) return {winner:b[a], line:[a,c,d]};
    }
    if(b.every(Boolean)) return {winner:'draw'};
    return null;
  }

  function checkGame(){
    const res = checkWin(board);
    if(res){
      finished = true;
      if(res.winner==='draw'){
        statusEl.innerHTML = '<b>Draw ü§ù</b>';
        celebration(true);
      } else {
        statusEl.innerHTML = `<b>${res.winner==='X'?player1:(vsAI && res.winner===ai ? 'AI ü§ñ' : player2)} Wins! üèÜ</b>`;
        highlight(res.line);
        Sound.play('win');
        celebration();
      }
    }
  }

  function highlight(line){
    line.forEach(idx=>{
      gridEl.children[idx].classList.add('win');
    });
  }

  function minimax(b, depth, isMax){
    const result = checkWin(b);
    if(result){
      if(result.winner===ai) return 10 - depth;
      if(result.winner===human) return depth - 10;
      if(result.winner==='draw') return 0;
    }
    const empties = emptyIndices(b);
    if(isMax){
      let best = -Infinity;
      for(const i of empties){
        b[i]=ai;
        best = Math.max(best, minimax(b, depth+1, false));
        b[i]=null;
      }
      return best;
    } else {
      let best = Infinity;
      for(const i of empties){
        b[i]=human;
        best = Math.min(best, minimax(b, depth+1, true));
        b[i]=null;
      }
      return best;
    }
  }

  function aiMove(){
    if(finished) return;
    let bestScore = -Infinity;
    let move = null;
    for(const i of emptyIndices(board)){
      board[i]=ai;
      let score = minimax(board, 0, false);
      board[i]=null;
      if(score>bestScore){
        bestScore=score;
        move=i;
      }
    }
    board[move]=ai;
    checkGame();
    if(!finished){
      turn = human;
      draw();
    }else{
      draw();
    }
  }

  function celebration(drawMode=false){
    const cBox = qs('#confetti');
    cBox.innerHTML='';
    const total = drawMode?18:34;
    for(let i=0;i<total;i++){
      const sp = document.createElement('span');
      sp.textContent = drawMode?'ü§ù':'üéâ';
      const size = Math.random()*18+18;
      sp.style.position='absolute';
      sp.style.left = (Math.random()*100)+'%';
      sp.style.top = (Math.random()*100)+'%';
      sp.style.fontSize = size+'px';
      sp.style.transform='translate(-50%,-50%) scale(.2)';
      sp.style.animation = 'burst .9s cubic-bezier(.34,1.6,.64,1) '+(Math.random()*0.4)+'s both';
      cBox.appendChild(sp);
    }
  }

  // Confetti animation style injection
  if(!document.getElementById('burstAnim')){
    const st = document.createElement('style');
    st.id='burstAnim';
    st.textContent=`@keyframes burst{0%{transform:translate(-50%,-50%) scale(.2) rotate(0deg);opacity:0;}60%{opacity:1;}100%{transform:translate(-50%,-50%) scale(1) rotate(360deg);opacity:0;}}`;
    document.head.appendChild(st);
  }

  draw();
  if(vsAI && turn===ai) aiMove();
}

/* ===============================
   INIT
=============================== */
console.log('[0x Battle Hub] Step 1 loaded');
startMusic(); // Start soft tone (auto)
</script>
</body>
</html>
